<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Eurobox</title>
  <style>
    :root{
      --bg:#0b0f17;
      --card:#111827;
      --text:#e5e7eb;
      --muted:#9ca3af;
      --line:#243042;
      --good:#22c55e;
      --bad:#ef4444;
      --btn:#1f2937;
      --btn2:#111827;
    }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background: radial-gradient(1200px 600px at 20% 0%, #1f2a44 0%, var(--bg) 55%);
      color:var(--text);
      padding:18px;
    }
    .wrap{
      max-width: 720px;
      margin: 0 auto;
    }
    .card{
      background: linear-gradient(180deg, #101a2b 0%, var(--card) 60%);
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 18px;
      padding: 18px;
      box-shadow: 0 18px 50px rgba(0,0,0,.35);
    }
    .top{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      margin-bottom: 12px;
    }
    .title{
      font-size: 26px;
      font-weight: 800;
      letter-spacing: .2px;
      margin:0;
      line-height:1.1;
    }
    .subtitle{
      margin:6px 0 0 0;
      color:var(--muted);
      font-size:14px;
    }
    .pill{
      padding:7px 10px;
      border-radius: 999px;
      font-size: 12px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      white-space:nowrap;
    }
    .pill.ok{
      border-color: rgba(34,197,94,.35);
      background: rgba(34,197,94,.14);
      color:#bbf7d0;
    }
    .pill.bad{
      border-color: rgba(239,68,68,.35);
      background: rgba(239,68,68,.14);
      color:#fecaca;
    }
    .hr{
      height:1px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.12), transparent);
      margin: 14px 0;
    }
    .label{
      font-size: 13px;
      color: var(--muted);
      margin: 0 0 8px 0;
    }
    textarea{
      width: 100%;
      min-height: 260px;
      padding: 14px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.25);
      color: var(--text);
      font-size: 18px;
      line-height: 1.35;
      resize: vertical;
      outline: none;
    }
    textarea::placeholder{ color: rgba(229,231,235,.45); }
    textarea:focus{
      border-color: rgba(99,102,241,.5);
      box-shadow: 0 0 0 4px rgba(99,102,241,.12);
    }
    .buttons{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top: 12px;
    }
    button{
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color: var(--text);
      border-radius: 12px;
      padding: 12px 14px;
      font-size: 16px;
      cursor: pointer;
      display:flex;
      gap:8px;
      align-items:center;
    }
    button:active{ transform: translateY(1px); }
    .btn-primary{
      background: linear-gradient(180deg, rgba(99,102,241,.35), rgba(99,102,241,.18));
      border-color: rgba(99,102,241,.45);
    }
    .small{
      margin-top: 10px;
      color: var(--muted);
      font-size: 12px;
      line-height: 1.35;
    }
    .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" id="card">
      <div class="top">
        <div>
          <h1 class="title">üì¶ Box <span id="boxId" class="mono"></span></h1>
          <p class="subtitle" id="subtitle">Notiz wird automatisch gespeichert.</p>
        </div>
        <div id="status" class="pill">Lade‚Ä¶</div>
      </div>

      <div class="hr"></div>

      <p class="label">Inhalt / Hinweise</p>
      <textarea id="content" placeholder="z.B. K√ºche: Besteck, T√∂pfe, Pfannen ‚Ä¶"></textarea>

      <div class="buttons">
        <button class="btn-primary" id="copyBtn" type="button">üìã Kopieren</button>
        <button id="clearBtn" type="button">üßπ Leeren</button>
      </div>

      <div class="small">
        Zugriff nur mit g√ºltigem Link: <span class="mono">?box=E001&amp;k=‚Ä¶</span><br/>
        Gespeichert lokal auf diesem iPhone (offline-tauglich).
      </div>
    </div>
  </div>

  <script>
    const params = new URLSearchParams(location.search);
    const box = (params.get("box") || "").toUpperCase().trim();
    const key = (params.get("k") || "").trim();

    const boxEl = document.getElementById("boxId");
    const statusEl = document.getElementById("status");
    const textarea = document.getElementById("content");

    function setStatus(ok, text){
      statusEl.textContent = text;
      statusEl.className = "pill " + (ok ? "ok" : "bad");
    }

    // Zugriff pr√ºfen
    if (!box || !key) {
      document.getElementById("card").innerHTML = `
        <h1 class="title">‚ùå Kein Zugriff</h1>
        <p class="subtitle">Der QR-Link muss <span class="mono">?box=E001&k=‚Ä¶</span> enthalten.</p>
      `;
      throw new Error("Kein Zugriff");
    }

    boxEl.textContent = box;

    // Speicher-Schl√ºssel: pro Box + pro Schl√ºssel eindeutig
    const storageKey = "eurobox_" + box + "_" + key;

    // Laden
    textarea.value = localStorage.getItem(storageKey) || "";
    setStatus(true, "Zugriff OK");

    // Auto-Save
    let t;
    textarea.addEventListener("input", () => {
      clearTimeout(t);
      t = setTimeout(() => {
        localStorage.setItem(storageKey, textarea.value);
        setStatus(true, "Gespeichert ‚úì");
      }, 200);
    });

    // Buttons
    document.getElementById("copyBtn").addEventListener("click", async () => {
      try {
        await navigator.clipboard.writeText(textarea.value);
        setStatus(true, "Kopiert ‚úì");
      } catch {
        setStatus(false, "Kopieren nicht m√∂glich");
      }
    });

    document.getElementById("clearBtn").addEventListener("click", () => {
      if (!confirm("Inhalt wirklich l√∂schen?")) return;
      textarea.value = "";
      localStorage.setItem(storageKey, "");
      setStatus(true, "Geleert ‚úì");
    });
  </script>
</body>
</html>
