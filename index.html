<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Eurobox</title>
  <style>
    :root{
      --bg:#0b0f17;
      --card:#111827;
      --text:#e5e7eb;
      --muted:#9ca3af;
      --line:#243042;
      --ok:#22c55e;
      --bad:#ef4444;
    }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background: radial-gradient(1200px 600px at 20% 0%, #1f2a44 0%, var(--bg) 55%);
      color:var(--text);
      padding:18px;
    }
    .wrap{ max-width: 760px; margin: 0 auto; }
    .card{
      background: linear-gradient(180deg, #101a2b 0%, var(--card) 60%);
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 18px;
      padding: 18px;
      box-shadow: 0 18px 50px rgba(0,0,0,.35);
    }
    .top{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      margin-bottom: 12px;
    }

    /* gro√üe, fette, zweigeteilte √úberschrift */
    .headline{
      display:flex;
      gap:10px;
      align-items:baseline;
      flex-wrap:wrap;
      margin:0;
      line-height:1.05;
    }
    .h-code{
      font-weight:900;
      font-size:34px;
      letter-spacing:.5px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      opacity:.95;
    }
    .h-title{
      font-weight:900;
      font-size:34px;
      letter-spacing:.2px;
    }
    .subtitle{
      margin:6px 0 0 0;
      color:var(--muted);
      font-size:14px;
    }

    .pill{
      padding:7px 10px;
      border-radius: 999px;
      font-size: 12px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      white-space:nowrap;
    }
    .pill.ok{
      border-color: rgba(34,197,94,.35);
      background: rgba(34,197,94,.14);
      color:#bbf7d0;
    }
    .pill.bad{
      border-color: rgba(239,68,68,.35);
      background: rgba(239,68,68,.14);
      color:#fecaca;
    }

    .hr{
      height:1px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.12), transparent);
      margin: 14px 0;
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
    }
    .rowlabel{
      font-size: 13px;
      color: var(--muted);
      margin: 0 0 6px 0;
    }

    input, textarea{
      width: 100%;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.25);
      color: var(--text);
      font-size: 18px;
      line-height: 1.35;
      padding: 12px 14px;
      outline: none;
      box-sizing: border-box;
    }
    input::placeholder, textarea::placeholder{ color: rgba(229,231,235,.45); }
    input:focus, textarea:focus{
      border-color: rgba(99,102,241,.5);
      box-shadow: 0 0 0 4px rgba(99,102,241,.12);
    }
    textarea{
      min-height: 260px;
      resize: vertical;
    }

    .two{
      display:grid;
      grid-template-columns: 140px 1fr;
      gap:10px;
    }
    @media (max-width: 520px){
      .two{ grid-template-columns: 1fr; }
      .h-code,.h-title{ font-size:30px; }
    }

    .buttons{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top: 12px;
    }
    button{
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color: var(--text);
      border-radius: 12px;
      padding: 12px 14px;
      font-size: 16px;
      cursor: pointer;
      display:flex;
      gap:8px;
      align-items:center;
    }
    button:active{ transform: translateY(1px); }
    .btn-primary{
      background: linear-gradient(180deg, rgba(99,102,241,.35), rgba(99,102,241,.18));
      border-color: rgba(99,102,241,.45);
    }

    .small{
      margin-top: 10px;
      color: var(--muted);
      font-size: 12px;
      line-height: 1.35;
    }
    .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card" id="card">
      <div class="top">
        <div>
          <h1 class="headline">
            <span class="h-code" id="hCode">E01</span>
            <span class="h-title" id="hTitle">Eurobox</span>
          </h1>
          <p class="subtitle" id="subtitle">Wird automatisch gespeichert ‚Äì pro Box/QR.</p>
        </div>
        <div id="status" class="pill">Lade‚Ä¶</div>
      </div>

      <div class="hr"></div>

      <!-- Editierbare Meta-Felder -->
      <div class="grid">
        <div class="two">
          <div>
            <div class="rowlabel">√úberschrift Teil 1 (max. 3)</div>
            <input id="inCode" maxlength="3" placeholder="E01" />
          </div>
          <div>
            <div class="rowlabel">√úberschrift Teil 2</div>
            <input id="inTitle" placeholder="z.B. K√ºche" />
          </div>
        </div>

        <div>
          <div class="rowlabel" id="labelText">Inhalt / Hinweise</div>
          <input id="inLabel" placeholder="Zeile oben benennen (z.B. K√ºche / Fragil / Inhalt)" />
        </div>

        <div>
          <textarea id="content" placeholder="Inhalt hier eintragen‚Ä¶"></textarea>
        </div>

        <div class="buttons">
          <button class="btn-primary" id="copyBtn" type="button">üìã Kopieren</button>
          <button id="clearBtn" type="button">üßπ Leeren</button>
        </div>

        <div class="small">
          Zugriff nur mit g√ºltigem Link: <span class="mono">?box=E001&amp;k=‚Ä¶</span><br/>
          Speicherung lokal auf diesem iPhone (offline-tauglich).
        </div>
      </div>
    </div>
  </div>

  <script>
    const params = new URLSearchParams(location.search);
    const box = (params.get("box") || "").toUpperCase().trim();
    const key = (params.get("k") || "").trim();

    const statusEl = document.getElementById("status");

    function setStatus(ok, text){
      statusEl.textContent = text;
      statusEl.className = "pill " + (ok ? "ok" : "bad");
    }

    // Zugriff pr√ºfen (Stufe 2: nur mit QR-Link)
    if (!box || !key) {
      document.getElementById("card").innerHTML = `
        <h1 class="headline"><span class="h-title">‚ùå Kein Zugriff</span></h1>
        <p class="subtitle">Der QR-Link muss <span class="mono">?box=E001&k=‚Ä¶</span> enthalten.</p>
      `;
      throw new Error("Kein Zugriff");
    }

    // DOM
    const hCode  = document.getElementById("hCode");
    const hTitle = document.getElementById("hTitle");

    const inCode  = document.getElementById("inCode");
    const inTitle = document.getElementById("inTitle");
    const inLabel = document.getElementById("inLabel");

    const labelText = document.getElementById("labelText");
    const content = document.getElementById("content");

    // Speicher-Schl√ºssel: pro Box + pro Schl√ºssel eindeutig
    const storageKey = "eurobox_" + box + "_" + key;

    // Defaultwerte (wenn noch nie gespeichert)
    const defaults = {
      code: box.slice(0, 3) || "E01",     // max 3 Zeichen
      title: "Eurobox",
      label: "Inhalt / Hinweise",
      content: ""
    };

    // Laden
    let state;
    try {
      state = JSON.parse(localStorage.getItem(storageKey) || "null") || defaults;
    } catch {
      state = defaults;
    }

    // Helper: max 3 Zeichen erzwingen + nur sichtbare Zeichen
    function normalizeCode(v){
      v = (v || "").toUpperCase().trim();
      return v.slice(0, 3);
    }

    function render(){
      hCode.textContent = normalizeCode(state.code) || "‚Äî";
      hTitle.textContent = (state.title || "").trim() || "‚Äî";
      labelText.textContent = (state.label || "").trim() || "Inhalt / Hinweise";

      inCode.value = normalizeCode(state.code);
      inTitle.value = (state.title || "");
      inLabel.value = (state.label || "");
      content.value = (state.content || "");
    }

    function save(silent = false){
      localStorage.setItem(storageKey, JSON.stringify(state));
      if (!silent) setStatus(true, "Gespeichert ‚úì");
    }

    render();
    setStatus(true, "Zugriff OK");

    // Auto-Save (debounced)
    let t;
    function scheduleSave(){
      clearTimeout(t);
      t = setTimeout(() => save(false), 200);
    }

    inCode.addEventListener("input", () => {
      state.code = normalizeCode(inCode.value);
      hCode.textContent = state.code || "‚Äî";
      scheduleSave();
    });

    inTitle.addEventListener("input", () => {
      state.title = inTitle.value;
      hTitle.textContent = (state.title || "").trim() || "‚Äî";
      scheduleSave();
    });

    inLabel.addEventListener("input", () => {
      state.label = inLabel.value;
      labelText.textContent = (state.label || "").trim() || "Inhalt / Hinweise";
      scheduleSave();
    });

    content.addEventListener("input", () => {
      state.content = content.value;
      scheduleSave();
    });

    // Buttons
    document.getElementById("copyBtn").addEventListener("click", async () => {
      try {
        await navigator.clipboard.writeText(content.value);
        setStatus(true, "Kopiert ‚úì");
      } catch {
        setStatus(false, "Kopieren nicht m√∂glich");
      }
    });

    document.getElementById("clearBtn").addEventListener("click", () => {
      if (!confirm("Alles leeren (√úberschrift, Label und Inhalt)?")) return;
      state = { ...defaults, code: normalizeCode(state.code) || defaults.code };
      save(true);
      render();
      setStatus(true, "Geleert ‚úì");
    });
  </script>
</body>
</html>
