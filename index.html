<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Bezeichnung</title>

<style>
  body {
    margin: 0;
    padding: 18px;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
    background: #0b0f17;
    color: #e5e7eb;
  }

  .card {
    max-width: 720px;
    margin: auto;
    background: #111827;
    border-radius: 22px;
    padding: 20px;
    box-shadow: 0 20px 60px rgba(0,0,0,.45);
  }

  /* === OBERE BOX-ID (E002) === */
  .box-id {
    text-align: center;
    font-size: 44px;
    font-weight: 900;
    letter-spacing: 2px;
    margin-bottom: 6px;
  }

  .status {
    text-align: center;
    font-size: 13px;
    color: #22c55e;
    margin-bottom: 14px;
  }

  /* === Überschrift nebeneinander === */
  .headline {
    display: grid;
    grid-template-columns: auto 1fr;
    gap: 14px;
    align-items: center;
    margin-bottom: 18px;
  }

  .code {
    font-size: 34px;
    font-weight: 900;
    font-family: ui-monospace, Menlo, Consolas, monospace;
  }

  .title {
    font-size: 34px;
    font-weight: 900;
  }

  input, textarea {
    width: 100%;
    box-sizing: border-box;
    border-radius: 16px;
    border: 1px solid rgba(255,255,255,.15);
    background: rgba(0,0,0,.35);
    color: #e5e7eb;
    padding: 14px;
    font-size: 18px;
    outline: none;
  }

  input:focus, textarea:focus {
    border-color: #6366f1;
  }

  .row {
    display: grid;
    grid-template-columns: 120px 1fr;
    gap: 12px;
    margin-bottom: 12px;
  }

  textarea {
    min-height: 340px;
    resize: vertical;
    margin-top: 12px;
    font-size: 17px;
  }

  @media (max-width: 520px) {
    .headline { grid-template-columns: 1fr 2fr; }
    .code, .title { font-size: 28px; }
    .box-id { font-size: 38px; }
    .row { grid-template-columns: 1fr; }
  }
</style>
</head>

<body>
<div class="card" id="card">

  <!-- BOX-ID OBEN -->
  <div class="box-id" id="boxId">E000</div>
  <div class="status" id="status">Wird automatisch gespeichert</div>

  <div class="headline">
    <div class="code" id="hCode">ORT</div>
    <div class="title" id="hTitle">Eurobox</div>
  </div>

  <div class="row">
    <input id="inCode" maxlength="3" placeholder="ORT" />
    <input id="inTitle" placeholder="Bezeichnung" />
  </div>

  <textarea id="content" placeholder="Inhalt hier eintragen…"></textarea>

</div>

<script>
  const params = new URLSearchParams(location.search);
  const box = (params.get("box") || "").toUpperCase().trim();

  // ✅ Kein Schlüssel mehr – QR-Code muss nur ?box=E002 enthalten
  if (!box) {
    document.getElementById("card").innerHTML = `
      <h2 style="color:#ef4444;margin:0 0 8px 0;">❌ Kein Zugriff</h2>
      <p style="margin:0;color:#9ca3af;">
        Bitte über einen QR-Code öffnen, der <code>?box=E001</code> enthält.
      </p>
    `;
    throw new Error("Kein Zugriff");
  }

  // Box-ID oben setzen
  document.getElementById("boxId").textContent = box;

  // ✅ Speicher pro Box (auf deinem iPhone)
  const storageKey = "eurobox_" + box;

  const hCode = document.getElementById("hCode");
  const hTitle = document.getElementById("hTitle");
  const inCode = document.getElementById("inCode");
  const inTitle = document.getElementById("inTitle");
  const content = document.getElementById("content");
  const status = document.getElementById("status");

  const defaults = {
    code: box.slice(0,3),
    title: "Eurobox",
    content: ""
  };

  let state;
  try {
    state = JSON.parse(localStorage.getItem(storageKey)) || defaults;
  } catch {
    state = defaults;
  }

  function render() {
    hCode.textContent = state.code || "—";
    hTitle.textContent = state.title || "—";
    inCode.value = state.code || "";
    inTitle.value = state.title || "";
    content.value = state.content || "";
  }

  function saveNow() {
    localStorage.setItem(storageKey, JSON.stringify(state));
    status.textContent = "Gespeichert ✓";
    status.style.color = "#22c55e";
  }

  let t;
  function autoSave() {
    clearTimeout(t);
    t = setTimeout(saveNow, 200);
  }

  inCode.addEventListener("input", () => {
    state.code = inCode.value.toUpperCase().slice(0,3);
    hCode.textContent = state.code;
    autoSave();
  });

  inTitle.addEventListener("input", () => {
    state.title = inTitle.value;
    hTitle.textContent = state.title;
    autoSave();
  });

  content.addEventListener("input", () => {
    state.content = content.value;
    autoSave();
  });

  render();
  status.textContent = "Zugriff OK – wird automatisch gespeichert";
  status.style.color = "#22c55e";
</script>
</body>
</html>
