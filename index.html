<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Suche</title>
  <style>
    :root{
      --bg1:#05070c;
      --card: rgba(255,255,255,.06);
      --stroke: rgba(255,255,255,.10);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.55);
      --good:#39d98a;
      --btn: rgba(40,70,140,.22);

      --grey:#C0C0C0;
      --karton:#ADAC62;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, -apple-system, system-ui, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      min-height:100vh;
      background: radial-gradient(1200px 700px at 50% -200px, #1a2a55 0%, var(--bg1) 35%) ,
                  radial-gradient(900px 700px at 50% 120%, #0b1a3c 0%, var(--bg1) 45%);
      padding: 18px 14px 24px;
      display:flex;
      justify-content:center;
      align-items:flex-start;
    }
    .wrap{ width:min(720px,100%); }

    .title{
      font-size: 44px;
      font-weight: 900;
      margin: 8px 0 14px;
      letter-spacing:.02em;
    }

    .search{
      width:100%;
      height:58px;
      border-radius: 18px;
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.18);
      color: var(--text);
      font-size: 18px;
      padding: 0 14px;
      outline:none;
    }

    .btnRow{
      display:flex;
      gap:12px;
      margin-top: 12px;
    }
    .btn{
      height:56px;
      border-radius: 18px;
      border:1px solid var(--stroke);
      background: var(--btn);
      color: var(--text);
      font-size: 18px;
      font-weight: 800;
      padding: 0 16px;
      cursor:pointer;
      white-space:nowrap;
    }

    .filters{
      display:flex;
      gap:10px;
      margin-top: 12px;
      align-items:center;
      flex-wrap:wrap;
    }
    .fchip{
      width:56px;height:56px;
      border-radius: 18px;
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.18);
      display:flex;align-items:center;justify-content:center;
      cursor:pointer;
      font-size: 22px;
      user-select:none;
    }
    .fchip.active{
      border-color: rgba(57,217,138,.60);
      box-shadow: 0 0 0 3px rgba(57,217,138,.18);
    }
    .fcolor{
      width:56px;height:56px;
      border-radius: 18px;
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.18);
      display:flex;align-items:center;justify-content:center;
      cursor:pointer;
      user-select:none;
      gap:8px;
      padding:0 10px;
    }
    .dot{
      width:18px;height:18px;border-radius:6px;
      border:1px solid rgba(255,255,255,.22);
    }
    .dot.grey{ background: var(--grey); }
    .dot.black{ background: #000; }
    .dot.karton{ background: var(--karton); }
    .meta{
      margin: 10px 0 10px;
      color: var(--muted);
      font-weight: 700;
    }

    .list{ display:flex; flex-direction:column; gap: 12px; margin-top: 8px; }

    .item{
      border-radius: 22px;
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.16);
      padding: 14px;
      display:flex;
      gap: 12px;
      align-items:stretch;
    }

    .left{
      min-width: 86px;
      display:flex;
      flex-direction:column;
      gap:8px;
      align-items:flex-start;
      justify-content:center;
    }
    .id{
      font-weight: 900;
      font-size: 26px;
      letter-spacing:.06em;
    }
    .icons{ display:flex; gap:8px; }
    .mini{
      width:40px;height:40px;border-radius: 14px;
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.18);
      display:flex;align-items:center;justify-content:center;
      font-size: 18px;
    }
    .mini.active{
      border-color: rgba(57,217,138,.60);
      box-shadow: 0 0 0 3px rgba(57,217,138,.18);
    }

    .mid{ flex:1; min-width: 0; }
    .name{
      font-size: 20px;
      font-weight: 900;
      margin-bottom: 2px;
    }
    .sub{ color: var(--muted); font-weight: 700; font-size: 14px; }
    .preview{
      margin-top: 6px;
      color: rgba(255,255,255,.82);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      font-weight: 650;
    }

    .right{
      display:flex;
      align-items:center;
    }
    .open{
      height: 52px;
      min-width: 110px;          /* ‚úÖ damit ‚Äû√ñffnen‚Äú nicht abgeschnitten ist */
      border-radius: 18px;
      border:1px solid var(--stroke);
      background: rgba(40,70,140,.22);
      color: var(--text);
      font-weight: 900;
      font-size: 18px;
      padding: 0 16px;
      cursor:pointer;
      white-space:nowrap;
    }

    @media (max-width: 420px){
      .open{ min-width: 120px; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="title">Suche</div>
    <input class="search" id="q" placeholder="Suche nach Ort, Bezeichnung, Inhalt, kg‚Ä¶ (z. B. E024)" />

    <div class="btnRow">
      <button class="btn" id="reload">Neu einlesen</button>
      <button class="btn" id="clear">Leeren</button>
    </div>

    <div class="filters">
      <div class="fchip" id="fFragile" title="Zerbrechlich">üç∑</div>
      <div class="fchip" id="fHeavy" title="Schwer (ab 16 kg)">üèãÔ∏è</div>
      <div class="fcolor" id="fGrey" title="Grau"><span class="dot grey"></span></div>
      <div class="fcolor" id="fBlack" title="Schwarz"><span class="dot black"></span></div>
      <div class="fcolor" id="fKarton" title="Karton"><span class="dot karton"></span></div>
    </div>

    <div class="meta" id="meta">Gefunden: 0 (nur dieses Ger√§t)</div>
    <div class="list" id="list"></div>
  </div>

<script>
(() => {
  const STORAGE_KEY = "eurobox_data_v1";
  const $ = (id) => document.getElementById(id);

  const elQ = $("q");
  const elList = $("list");
  const elMeta = $("meta");

  const fFragile = $("fFragile");
  const fHeavy = $("fHeavy");
  const fGrey = $("fGrey");
  const fBlack = $("fBlack");
  const fKarton = $("fKarton");

  const state = {
    fragile:false,
    heavy:false,
    grey:false,
    black:false,
    karton:false
  };

  function loadAll(){
    try{ return JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}"); }
    catch{ return {}; }
  }

  let all = loadAll();

  function colorHex(color){
    if (color === "black") return "#000";
    if (color === "karton") return "#ADAC62";
    return "#C0C0C0";
  }

  function heavyByWeight(w){
    return Number(w || 0) >= 16;
  }

  function matchesFilters(item){
    if (state.fragile && !item.fragile) return false;
    if (state.heavy && !heavyByWeight(item.weight)) return false;

    const c = (item.color || (item.id||"").startsWith("K") ? "karton" : "grey");
    const wantColor = state.grey || state.black || state.karton;
    if (wantColor){
      if (state.grey && c === "grey") return true;
      if (state.black && c === "black") return true;
      if (state.karton && c === "karton") return true;
      return false;
    }
    return true;
  }

  function normalize(s){
    return (s||"").toString().toLowerCase();
  }

  function itemText(item){
    return [
      item.id,
      item.ort,
      item.bez,
      item.text,
      (item.weight ? String(item.weight) : "")
    ].map(normalize).join(" ");
  }

  function render(){
    const q = normalize(elQ.value).trim();

    const items = Object.values(all)
      .filter(it => it && it.id && /^[EK]\d{3}$/.test(it.id))
      .sort((a,b) => a.id.localeCompare(b.id))
      .filter(it => matchesFilters(it))
      .filter(it => !q || itemText(it).includes(q));

    elMeta.textContent = `Gefunden: ${items.length} (nur dieses Ger√§t)`;
    elList.innerHTML = "";

    for (const it of items){
      const c = it.color || (it.id.startsWith("K") ? "karton" : "grey");
      const heavy = heavyByWeight(it.weight);

      const div = document.createElement("div");
      div.className = "item";

      const left = document.createElement("div");
      left.className = "left";

      const id = document.createElement("div");
      id.className = "id";
      id.textContent = it.id;

      const icons = document.createElement("div");
      icons.className = "icons";

      const miniColor = document.createElement("div");
      miniColor.className = "mini";
      miniColor.style.background = colorHex(c);

      const miniFrag = document.createElement("div");
      miniFrag.className = "mini";
      miniFrag.textContent = "üç∑";
      if (it.fragile) miniFrag.classList.add("active");

      const miniHeavy = document.createElement("div");
      miniHeavy.className = "mini";
      miniHeavy.textContent = "üèãÔ∏è";
      if (heavy) miniHeavy.classList.add("active");

      icons.appendChild(miniColor);
      icons.appendChild(miniFrag);
      icons.appendChild(miniHeavy);

      left.appendChild(id);
      left.appendChild(icons);

      const mid = document.createElement("div");
      mid.className = "mid";

      const name = document.createElement("div");
      name.className = "name";
      name.textContent = it.bez && it.bez.trim() ? it.bez.trim() : "(ohne Bezeichnung)";

      const sub = document.createElement("div");
      sub.className = "sub";
      const dt = it.updatedAt ? new Date(it.updatedAt) : null;
      sub.textContent = "Zuletzt: " + (dt && !isNaN(dt) ? dt.toLocaleString() : "-");

      const prev = document.createElement("div");
      prev.className = "preview";
      const firstLine = (it.text || "").split("\n").find(l => l.trim()) || "";
      prev.textContent = firstLine;

      mid.appendChild(name);
      mid.appendChild(sub);
      mid.appendChild(prev);

      const right = document.createElement("div");
      right.className = "right";

      const open = document.createElement("button");
      open.className = "open";
      open.textContent = "√ñffnen";
      open.addEventListener("click", () => {
        location.href = `./?box=${encodeURIComponent(it.id)}`;
      });

      right.appendChild(open);

      div.appendChild(left);
      div.appendChild(mid);
      div.appendChild(right);

      elList.appendChild(div);
    }
  }

  function toggle(el, key){
    state[key] = !state[key];
    el.classList.toggle("active", state[key]);
    render();
  }

  fFragile.addEventListener("click", () => toggle(fFragile, "fragile"));
  fHeavy.addEventListener("click", () => toggle(fHeavy, "heavy"));
  fGrey.addEventListener("click", () => toggle(fGrey, "grey"));
  fBlack.addEventListener("click", () => toggle(fBlack, "black"));
  fKarton.addEventListener("click", () => toggle(fKarton, "karton"));

  $("reload").addEventListener("click", () => {
    all = loadAll();
    render();
  });

  $("clear").addEventListener("click", () => {
    elQ.value = "";
    render();
  });

  elQ.addEventListener("input", render);

  render();
})();
</script>
</body>
</html>
