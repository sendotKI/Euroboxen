<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Eurobox</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --bg:#0b1220;
  --card:#151c2f;
  --border:#2a3555;
  --text:#ffffff;
  --muted:#9aa3b2;
  --ok:#35d07f;
  --red:#ff4d4d;
  --grey:#C0C0C0;
}

body{
  margin:0;
  background:linear-gradient(180deg,#050810,#0b1220);
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
  color:var(--text);
}

.container{
  max-width:480px;
  margin:20px auto;
  padding:20px;
}

.card{
  background:var(--card);
  border-radius:20px;
  padding:20px;
  box-shadow:0 0 40px rgba(0,0,0,.6);
  transition:.2s;
}

h1{
  text-align:center;
  margin:0;
  font-size:36px;
  letter-spacing:2px;
}

.status{
  text-align:center;
  color:var(--ok);
  margin-top:6px;
}

.hint{
  text-align:center;
  color:var(--muted);
  margin-top:6px;
  font-size:12px;
}

.row{
  display:flex;
  gap:10px;
  margin-top:16px;
}

input,textarea{
  background:#0f172a;
  border:1px solid var(--border);
  border-radius:14px;
  color:#fff;
  padding:12px;
  font-size:16px;
  width:100%;
}

textarea{
  height:180px;
  resize:none;
}

.icon{
  width:56px;
  height:56px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:26px;
  border-radius:16px;
  border:2px solid var(--border);
  cursor:pointer;
  transition:.15s;
  user-select:none;
}

.icon.active{
  border-color:var(--ok);
  box-shadow:0 0 12px rgba(53,208,127,.6);
}

.icon.heavy.active{
  border-color:var(--red);
  box-shadow:0 0 14px rgba(255,77,77,.7);
}

.weightBox{
  width:96px;
  text-align:center;
  font-weight:700;
}

.color{
  width:28px;   /* 50% kleiner als vorherige gro√üe Schalter */
  height:28px;
  border-radius:8px;
  border:2px solid #444;
  cursor:pointer;
}
.color.active{
  outline:2px solid var(--ok);
}

.buttons{
  display:flex;
  gap:10px;
  margin-top:20px;
}

button, .btnLike{
  flex:1;
  padding:12px;
  border-radius:14px;
  border:none;
  background:#1f2a4d;
  color:#fff;
  font-size:14px;
  cursor:pointer;
  text-align:center;
  display:inline-flex;
  align-items:center;
  justify-content:center;
}

button:active, .btnLike:active{
  transform:scale(.99);
}

.toast{
  margin-top:10px;
  font-size:13px;
  color:var(--muted);
  text-align:center;
}

/* wichtig: NICHT hidden/display:none, damit label for="" zuverl√§ssig funktioniert */
.fileOffscreen{
  position:absolute;
  left:-10000px;
  top:auto;
  width:1px;
  height:1px;
  opacity:0;
}
</style>
</head>

<body>
<div class="container">
  <div class="card" id="card">

    <h1 id="boxId">E000</h1>
    <div class="status" id="saveStatus">Gespeichert ‚úì</div>
    <div class="hint" id="platformHint"></div>

    <div class="row">
      <input id="ort" maxlength="6" placeholder="ORT">
      <input id="bez" placeholder="Bezeichnung">
    </div>

    <div class="row">
      <div class="icon" id="fragile" title="Zerbrechlich">üç∑</div>
      <div class="icon heavy" id="heavy" title="Schwer (ab 16 kg)">üèãÔ∏è</div>
      <input id="kg" class="weightBox" type="number" min="0" max="99" placeholder="00 kg">
    </div>

    <div class="row">
      <div class="color active" id="grey" title="Grau" style="background:#C0C0C0"></div>
      <div class="color" id="black" title="Schwarz" style="background:#000"></div>
    </div>

    <textarea id="content" placeholder="‚Ä¢ Inhalt hier eintragen‚Ä¶"></textarea>

    <div class="buttons">
      <button id="btnExport" type="button">Backup nach iCloud</button>

      <!-- Statt JS-click: Label √∂ffnet Datei-Dialog stabil (kein Chrome-Crash) -->
      <label class="btnLike" for="fileInput" id="btnImport">Backup importieren</label>
      <label class="btnLike" for="fileInput" id="btnLoad">Euroboxen.json einlesen</label>
    </div>

    <div class="toast" id="toast"></div>

  </div>
</div>

<input type="file" id="fileInput" class="fileOffscreen" accept=".json,application/json">

<script>
const $ = id => document.getElementById(id);

const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
$("platformHint").textContent = isIOS
  ? "iPhone: Backup ‚Üí Teilen ‚Üí In Dateien sichern ‚Üí iCloud Drive"
  : "Windows: Backup l√§dt Euroboxen.json herunter. Import liest sie wieder ein.";

const box = new URLSearchParams(location.search).get("box") || "E000";
$("boxId").textContent = box;

let data = JSON.parse(localStorage.getItem("Euroboxen")||"{}");

let state = data[box] || {
  ort:"",
  bez:"",
  content:"",
  fragile:false,
  heavy:false,
  kg:0,
  color:"grey"
};

function showToast(msg){
  $("toast").textContent = msg;
  setTimeout(()=>{ if($("toast").textContent===msg) $("toast").textContent=""; }, 3500);
}

function save(){
  state.ort = $("ort").value;
  state.bez = $("bez").value;
  state.content = $("content").value;

  data[box] = state;
  localStorage.setItem("Euroboxen", JSON.stringify(data));
}

$("ort").value = state.ort;
$("bez").value = state.bez;
$("content").value = state.content || "‚Ä¢ ";
$("kg").value = (state.kg ?? "");

$("fragile").classList.toggle("active", !!state.fragile);
$("heavy").classList.toggle("active", !!state.heavy);

function setColor(c){
  state.color=c;
  $("grey").classList.toggle("active",c==="grey");
  $("black").classList.toggle("active",c==="black");
  $("card").style.background = (c==="grey") ? "#C0C0C0" : "#000";
  save();
}
$("grey").onclick=()=>setColor("grey");
$("black").onclick=()=>setColor("black");
setColor(state.color || "grey");

$("fragile").onclick = ()=>{
  state.fragile=!state.fragile;
  $("fragile").classList.toggle("active",state.fragile);
  save();
};

// Heavy automatisch ab 16 kg
$("kg").addEventListener("input", ()=>{
  const v = parseInt(($("kg").value||"0"),10);
  state.kg = isNaN(v) ? 0 : v;
  state.heavy = state.kg >= 16;
  $("heavy").classList.toggle("active", state.heavy);
  save();
});

document.querySelectorAll("input,textarea").forEach(el=>el.addEventListener("input", save));

// Bullet-Liste
$("content").addEventListener("keydown",e=>{
  if(e.key==="Enter"){
    e.preventDefault();
    $("content").value += "\n‚Ä¢ ";
    save();
  }
  if(e.key==="Backspace" && $("content").value.endsWith("\n‚Ä¢ ")){
    $("content").value = $("content").value.slice(0,-3);
    save();
  }
});

// Export (Windows-safe)
function exportBackup(){
  try{
    const json = JSON.stringify(data, null, 2);
    const blob = new Blob([json], {type:"application/json"});
    const url = URL.createObjectURL(blob);

    const a = document.createElement("a");
    a.href = url;
    a.download = "Euroboxen.json";
    document.body.appendChild(a);
    a.click();
    a.remove();

    setTimeout(()=>URL.revokeObjectURL(url), 1000);
    showToast("Backup exportiert: Euroboxen.json");
  }catch(err){
    showToast("Fehler beim Export: " + err.message);
  }
}
$("btnExport").addEventListener("click", exportBackup);

// Import (f√ºr beide Labels gleich)
$("fileInput").addEventListener("change", (e)=>{
  const file = e.target.files && e.target.files[0];
  if(!file) return;

  const r = new FileReader();
  r.onload = ()=>{
    try{
      const obj = JSON.parse(r.result);
      if(typeof obj !== "object" || obj === null) throw new Error("Ung√ºltige JSON-Struktur");

      data = obj;
      localStorage.setItem("Euroboxen", JSON.stringify(data));
      const count = Object.keys(data).length;
      showToast("Import OK: " + count + " Box(en) geladen.");

      // UI neu bef√ºllen (ohne location.reload ‚Üí stabiler)
      state = data[box] || state;

      $("ort").value = state.ort || "";
      $("bez").value = state.bez || "";
      $("content").value = state.content || "‚Ä¢ ";
      $("kg").value = (state.kg ?? "");

      $("fragile").classList.toggle("active", !!state.fragile);
      state.heavy = (parseInt(state.kg||"0",10) >= 16) || !!state.heavy;
      $("heavy").classList.toggle("active", !!state.heavy);
      setColor(state.color || "grey");

    }catch(err){
      showToast("Import fehlgeschlagen: " + err.message);
    }finally{
      // wichtig: damit man dieselbe Datei nochmal ausw√§hlen kann
      $("fileInput").value = "";
    }
  };
  r.readAsText(file);
});
</script>

</body>
</html>
